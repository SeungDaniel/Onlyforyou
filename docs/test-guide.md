# 🧪 테스트 가이드 (Test Guide)

개발자 및 관리자를 위한 봇 기능 검증 가이드입니다.

## 1. 환경 설정 및 실행

1. 프로젝트 폴더로 이동: `cd Miin` (또는 해당 프로젝트 경로)
2. 가상환경 활성화: `source venv/bin/activate` (Mac/Linux)
3. 봇 실행: `python main.py`
4. 로그 확인: 터미널에 `Scheduler started...` 메시지가 뜨는지 확인.

## 2. 기능별 테스트 시나리오

### A. 초기 설정 및 메뉴 테스트

1. 텔레그램에서 `/start` 입력.
2. **기대 결과**:
   - "sh님이 보내신..." 환영 메시지 출력.
   - [설정], [음악], [안내] 3개의 인라인 버튼 표시.
   - `user_data.json`에 사용자 정보(chat_id, username) 저장 확인.

### B. 시간 설정 테스트 (자연어 처리)

1. `/setup` 입력 또는 "설정" 채팅 입력.
2. **[저녁 (운동)]** 버튼 클릭.
3. "오후 8시 5분" 입력.
4. **기대 결과**:
   - 봇이 "20:05으로 설정했어요!"라고 응답.
   - `user_data.json` 파일에 `exercise_time`: `20:05` 업데이트 확인.

### C. 알림 발송 및 랜덤 메시지 테스트

*실제 시간을 기다리기 힘들므로, 현재 시간 + 1분 뒤로 설정하여 테스트합니다.*

1. 현재 시간이 15:00라면, `/setup` -> [점심 (비타민)] -> "오후 3시 1분" 설정.
2. 1분 대기.
3. **기대 결과**:
   - 점심 관련 메시지(아해티, 비타민C 언급) 도착.
   - 메시지 내용이 매번 조금씩 달라지는지 확인 (랜덤 로직).
   - **[✅ 완료!]** 버튼 클릭 시, 칭찬 메시지로 수정되는지 확인.

### D. 운동 미션 테스트

1. 운동 시간을 현재 시간 + 1분 뒤로 설정.
2. **기대 결과**:
   - "스쿼트 5회", "기지개 펴기" 등 구체적인 운동 미션이 포함된 메시지 도착.

### E. 음악 추천 테스트

1. `/music` 입력 또는 [음악] 버튼 클릭.
2. [☁️ 우울해] 버튼 클릭.
3. **기대 결과**:
   - 위로가 되는 멘트와 함께 유튜브 링크(예: 슈베르트, 라흐마니노프) 도착.
   - 링크 클릭 시 정상 재생 확인.

## 3. 트러블슈팅

- **봇이 응답하지 않음**: 터미널 로그에 에러가 없는지 확인. 토큰이 올바른지 `.env` 확인.
- **시간 인식이 안 됨**: `utils.py`의 정규식 로직 확인. "오전/오후" 띄어쓰기 등 다양한 케이스 테스트.
- **알림이 안 옴**: `scheduler.py`의 `APScheduler`가 정상 작동 중인지 로그 확인. (Timezone 문제일 수 있음, 현재 설정은 시스템 시간 따름)

## ⚡️ 빠른 실행 (복붙용)

터미널에 아래 명령어를 한 번에 복사해서 붙여넣으세요. (Mac/Linux 기준)

```bash
# 1. 프로젝트 폴더로 이동 (경로 확인 필요)
cd ~/PycharmProjects/PythonProject/Miin

# 2. 가상환경 생성 (최초 1회만 필요)
# python3 -m venv venv

# 3. 가상환경 활성화 및 라이브러리 설치
source venv/bin/activate
pip install -r requirements.txt

# 4. 봇 실행
python main.py
```

## 4. 서버 백그라운드 실행 및 관리 (nohup 방식)

서버에서 터미널을 꺼도 봇이 계속 실행되게 하려면 `nohup`을 사용하면 간단합니다.

### A. 백그라운드 실행 (`nohup`)

터미널 연결을 끊어도 봇이 죽지 않도록 실행하는 명령어입니다.

```bash
# 1. 봇 실행 (로그를 output.log에 저장)
nohup python3 main.py > output.log 2>&1 &

# 2. 잘 실행됐는지 확인
ps aux | grep main.py
```

### B. 로그 실시간 확인

실행 중인 봇의 상태를 확인하려면 로그를 봅니다.

```bash
# 실시간 로그 보기 (종료하려면 Ctrl + C)
tail -f output.log
```

### C. 봇 중단 (재시작 시 필수)

코드를 수정했거나 봇을 끄고 싶을 때는 프로세스를 찾아서 종료해야 합니다.

```bash
# 1. 프로세스 ID (PID) 찾기 (주의: 다른 프로젝트의 main.py와 헷갈리지 않게 폴더명도 같이 확인!)
ps aux | grep "miin-bot"
# 또는
ps aux | grep "python3 main.py"
# (출력에서 ./venv/bin/python main.py 처럼 경로를 꼭 확인하세요!)

# 2. 프로세스 종료 (강제 종료)
kill -9 [PID]
```

> **주의**: 서버에 다른 파이썬 프로그램이 돌고 있다면 `ps aux | grep main.py`는 위험할 수 있습니다. 꼭 `miin-bot` 폴더인지 확인하고 종료하세요!

> **참고**: 24시간 안정적으로 운영하려면 `deployment_guide.md`의 **Systemd** 방식을 추천합니다. (서버 재부팅 시 자동 실행됨)

## 5. 배포 업데이트 (Git Pull)

코드를 수정해서 GitHub에 올린 후, 서버에 반영하는 방법입니다.

1. **프로젝트 폴더로 이동**
   ```bash
   cd ~/miin-bot  # 또는 설치된 경로
   ```

2. **최신 코드 내려받기**
   ```bash
   git pull origin main
   ```

3. **봇 재시작** (기존 프로세스 종료 후 다시 실행)
   ```bash
   # 프로세스 종료
   pkill -f "python3 main.py"

   # 다시 실행 (nohup)
   nohup python3 main.py > output.log 2>&1 &
   ```
   > **Note**: `pkill`은 "python3 main.py"가 포함된 모든 프로세스를 종료합니다. 이 서버에서 이 봇만 실행 중이라면 가장 간편한 방법입니다.
